# Пошаговый план реализации Desktop-версии KMP-чата с LLM

## Этап 1. Подготовка проекта

1. Создать Kotlin Multiplatform проект.
2. Добавить `desktop` target.
3. Подключить Compose Multiplatform Desktop.
4. Настроить Kotlin Coroutines.
5. Подключить Ktor Client для работы с LLM API.
6. Настроить управление зависимостями (Koin или Manual DI).

## Этап 2. Модели данных

7. Создать модель `Message` с полями: `id`, `content`, `isUser`, `timestamp`.
8. Создать модель `LLMResponse` с полями: `message`, `success`.

## Этап 3. Репозиторий (в памяти)

9. Создать класс `ChatRepository`.
10. Внутри репозитория создать список сообщений как **in-memory cache**.
11. Реализовать метод `sendMessage`:
    - Добавляет сообщение пользователя в кеш.
    - Отправляет запрос на LLM API.
    - Добавляет ответ LLM в кеш.
12. Реализовать метод `getMessages`, который возвращает текущий список сообщений.
13. Реализовать метод `clearMessages`, который очищает кеш.

## Этап 4. ViewModel

14. Создать `ChatViewModel`.
15. Добавить состояние списка сообщений (`messages`) для UI.
16. Добавить состояние ввода (`input`) для поля ввода.
17. Реализовать метод `sendMessage`:
    - Берёт текст из `input`.
    - Отправляет в репозиторий через корутину.
    - Обновляет `messages` после получения ответа.
18. Реализовать метод `clearChat`, который очищает кеш и UI.
19. Настроить потокобезопасность (UI обновляется в основном потоке).

## Этап 5. Сетевой слой (LLM)

20. Настроить Ktor Client.
21. Создать функцию для отправки сообщения на выбранный LLM API.
22. Обработать ответ и вернуть его в виде `LLMResponse`.
23. Добавить обработку ошибок сети:
    - Отображать ошибку пользователю.
    - Не допускать падения приложения.

## Этап 6. UI (Compose Desktop)

24. Создать основное окно приложения с заголовком "LLM Chat".
25. Разделить экран на:
    - Область сообщений (скролл/лист)
    - Поле ввода сообщения
    - Кнопку "Send"
    - Кнопку "Clear Chat"
26. Настроить отображение сообщений:
    - Сообщения пользователя и бота визуально различаются (цвет, выравнивание).
27. Настроить привязку UI к состояниям ViewModel (`messages` и `input`).
28. Настроить автопрокрутку вниз при добавлении новых сообщений.
29. Настроить отправку сообщений по Enter.
30. Настроить кнопку очистки диалога:
    - При нажатии вызывает `clearChat`.

## Этап 7. Логика диалога

31. При запуске приложения добавлять приветственное сообщение от LLM.
32. Хранить диалог только в памяти.
33. При нажатии "Clear Chat" начинать новый диалог.
34. Проверить, что новые сообщения после очистки добавляются в новый диалог.

## Этап 8. UX и дополнительные детали

35. Добавить визуальный индикатор "Bot is typing..." при ожидании ответа.
36. Проверить, что пустое сообщение не отправляется.
37. Настроить минимальную задержку UI при отправке сообщения (опционально).
38. Настроить масштабирование окна и удобное расположение элементов.

## Этап 9. Тестирование

39. Проверить отправку сообщений:
    - Пользователь → бот → UI обновляется.
40. Проверить очистку диалога:
    - Кнопка "Clear Chat" очищает кеш и UI.
41. Проверить ошибки сети:
    - При недоступности API приложение не падает.
42. Проверить автопрокрутку сообщений.
43. Проверить визуальные различия сообщений пользователя и бота.
44. Проверить повторные диалоги после очистки.

## Этап 10. Сборка и развертывание

45. Собрать Desktop приложение с Compose Multiplatform.
46. Убедиться, что все зависимости упакованы.
47. Протестировать работу на Windows, Mac и Linux.
48. Подготовить инструкцию по запуску приложения.